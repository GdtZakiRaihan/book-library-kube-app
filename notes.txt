

curl -H "Accept: application/vnd.github.everest-preview+json" \
    -H "Authorization: token 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" \
    --request POST \
    --data '{"event_type": "deploy-book-info-service-infra", "client_payload": { "buildnumber": "'"$BUILD_NUMBER"'" }}' \
    https://api.github.com/repos/abvijaykumar/book-library-kube-infra/dispatches



    # Build the Docker image
    - name: Build with Docker
      run: |
        cd bozo-book-info-service
        ./mvnw package -Dnative
        docker images
        docker build -f Dockerfile.native -t $IMAGE_NAME:$BUILD_NUMBER .
        docker images

    - name: Login to Docker Hub
      uses: docker/login-action@v1
      with:
        username: ${{secrets.DOCKERHUB_USERNAME}}
        password: ${{secrets.DOCKERHUB_PASSWORD}}

    # Push the image to Dockerhub
    - name: Push the image to Dockerhub
      run: |
        docker image tag $IMAGE_NAME:$BUILD_NUMBER docker.io/$DOCKER_USERNAME/$IMAGE_NAME:$BUILD_NUMBER
        docker image push docker.io/$DOCKER_USERNAME/$IMAGE_NAME:$BUILD_NUMBER




            # Invoke the infra gitops
    - name: Invoke book-info-service Infra GitOps pipe
      uses: peter-evans/repository-dispatch@v1
      with:
          token: ${{secrets.API_TOKEN_GITHUB}}
          repository: abvijaykumar/book-library-kube-infra
          event-type: deploy-book-info-service-infra
          client-payload: '{"buildnumber": "$BUILD_NUMBER"}'